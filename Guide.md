プロジェクト名 **「MLE (Mentor-Logic Engine)」**。

---

## 🤝 AI協働ガイドライン（重要）

このプロジェクトにおけるAIの役割と作業方針：

### **AIの役割**
- **ガイド・メンター:** ユーザーの学習と開発をサポートする
- **シニアエンジニア視点:** 技術的助言とベストプラクティスの提案
- **コードレビュアー:** ユーザーが書いたコードに対してフィードバックを提供
- **ブレストパートナー:** アイデアの壁打ち相手として、思考を整理・発展させる
- **客観的アドバイザー:** 冷静な意見と異なる視点を提供

### **作業方針（必須）**
1. ✋ **答えを勝手に出さない** - 常にユーザーの判断を尊重する
2. 💬 **必ず実行前に相談** - コード生成や変更の前に提案し、承認を得る
3. 🏗️ **スケルトンコード提供** - 土台・構造のみを用意し、実装はユーザーが行う
4. 👀 **フィードバック重視** - ユーザーのコードをレビューし、改善点を指摘する
5. 🎓 **教育的アプローチ** - Why（なぜ）を説明し、理解を深める
6. 💡 **積極的なブレスト** - ユーザーと一緒にアイデアを探索し、選択肢を提示する
7. 🤔 **疑問点の共有** - 気になる点や懸念事項があれば冷静に指摘する
8. 🔍 **問いかけによる気づき** - 答えではなく、考えるきっかけとなる質問を投げかける

### **禁止事項**
- ❌ ユーザーの承認なしにコードを書く・実行する
- ❌ 完全な実装を提供する（学習機会を奪わない）
- ❌ 一方的に技術選定や設計を決定する
- ❌ 疑問や懸念を隠して黙って進める

### **ブレストの姿勢**
- 「こういう選択肢もありますが、どう思いますか？」
- 「この部分、〇〇のリスクが気になるのですが…」
- 「なぜ△△のアプローチを選ばれたのか教えていただけますか？」
- 「別の視点として××も考えられますが、検討してみますか？」

---

この計画書は、**「他のAI（ChatGPTやClaude等）にそのまま渡して開発をスタートさせるためのマスター指示書」**として作成しました。シニアエンジニアの視点で、128GB RAMという最強のインフラを前提とした高精度な設計を詰め込んでいます。

---

# 🛠️ Mentor-Logic Engine (MLE) プロジェクト詳細仕様書

## 1. プロジェクト概要

**MLE**は、統計学の学習における「論理の脱線」を特定し、自律的に指導を行うAI家庭教師エンジン。

* **コア・コンセプト:** 「答えを教えず、思考をデバッグする」
* **ターゲット:** 統計検定2級〜準1級レベルの学習者
* **技術的優位性:** 128GB RAMを活かした「思考型VLM」と「数理検証エンジン（SymPy）」の統合

---

## 2. システムアーキテクチャ（4層レイヤー設計）

### **Layer 1: Perception (Vision OCR)**

* **役割:** iPadの筆跡・画像をLaTeXおよび座標データへ変換。
* **使用モデル:** Qwen2.5-VL-72B (Q8_0)
* **出力:** 構造化JSON `{latex, confidence, bbox, stroke_id}`

### **Layer 2: Reasoning (Thinking Logic)**

* **役割:** ユーザーの論理ミス（検定手法の誤り、変数の混同等）を特定。
* **使用モデル:** Qwen3-Max-Thinking または Qwen3-VL-8B-Thinking
* **思考プロセス:** Chain-of-Thoughtを用いて、ユーザーの「現在の式」から「次の正解への最短距離」を逆算。

### **Layer 3: Verification (Formal Math)**

* **役割:** AIのハルシネーションを防止し、数理的絶対性を保証。
* **使用技術:** SymPy (Python)
* **動作:** LaTeXを代数式にパースし、数理的に等価か判定。

### **Layer 4: Orchestration (State Management)**

* **役割:** ユーザーの学習履歴や問題の文脈を管理。
* **使用技術:** LangGraph
* **状態（State）:** `{problem_statement, step_history, variables, last_error_type}`

---

## 3. 重要機能の技術仕様

### **3.1. 確信度ベースのヒューマン・イン・ザ・ループ**

* **仕様:** VLMがシンボル（等）を認識する際、ロジット値（Confidence Score）を取得。
* **閾値:** 0.85未満の文字に対し、iPad UI上で「黄色い点滅ハイライト」を生成。
* **目的:** 誤読による誤指導を防止し、ユーザーとの認識合わせを行う。

### **3.2. イベント駆動型トリガー（非リアルタイム）**

* **仕様:** 下記3つのイベントで解析を開始。
1. Apple Pencilの5秒間の静止検知。
2. ペン先での特定のジェスチャー（ダブルタップ等）。
3. 手動の解析ボタン押下。


* **メリット:** 計算資源の節約と、ユーザーの集中力の維持。

---

## 4. 開発ロードマップ（全12週）

| 週 | フェーズ | 具体的タスク |
| --- | --- | --- |
| **W1-3** | **Perception** | Mac StudioにQwen2.5-VLを構築。手書き数式のLaTeX抽出精度をテスト。 |
| **W4-6** | **Verification** | SymPyを用いたLaTeX等価性判定エンジンの作成。統計表データのDB化。 |
| **W7-9** | **Reasoning** | LangGraphを用いた「指導シナリオ」の実装。ミスに応じた問いかけの生成。 |
| **W10-12** | **Integration** | iPad UI (Fabric.js) の実装。FastAPIを用いたWebSocket通信の統合。 |

---

## 5. 他のAIに指示を出すための「プロンプト・ガイド」

他のAI（開発用）に指示を出す際は、以下のテキストをコピーして使ってください。

### **プロンプト A：数理検証エンジンの作成（Phase 1用）**

> 「私は統計学特化型AIエンジン『MLE (Mentor-Logic Engine)』を開発しています。
> 次のタスクを実行してください：
> 1. PythonとSymPyを使用して、2つのLaTeX文字列（例：`\frac{x - \mu}{\sigma/\sqrt{n}}`）を受け取り、それらが数学的に等価であるか判定する関数を作成してください。
> 2. 統計学特有の記号（など）を適切に変数として処理できるようにしてください。
> 3. ユーザーが途中の計算で端数処理（例：1.96を2とする）をした場合の許容誤差（Tolerance）を設けるロジックを含めてください。」
> 
> 

### **プロンプト B：認識精度の評価（Phase 1用）**

> 「Qwen2.5-VLモデルを使用して、手書き画像からLaTeXを抽出するスクリプトを作成してください。
> 出力は、各数式コンポーネントの確信度（Confidence Score）と座標（Bounding Box）を含むJSON形式にしてください。
> 特に  と  のような似た文字の誤認識を検知し、確信度が低い場合に警告フラグを立てるロジックを実装してください。」

---

## 6. シニアエンジニアとしての懸念点と対策

* **懸念1:** 統計表（Z表など）の読み取りミス。
* **対策:** RAGではなく、表のデータを**静的なJSON（Lookup Table）**としてプログラム内に保持し、AIが直接数値を参照できるようにする。


* **懸念2:** 32GB仕事機でのデバッグ負荷。
* **対策:** 仕事機では8Bモデルの4bit量子化版を使い、UIや通信ロジックのみをテストする。重い推論はMac Studioへ常にAPIリクエストを飛ばす設計にする。


